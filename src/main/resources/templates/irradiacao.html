<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irradiação</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .ponto-container {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
        }
        .ponto-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .coords-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .coords-container input {
            width: 80px;
        }
        .coords-label {
            min-width: 70px;
        }
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">Irradiação</h2>

    <form id="irradiacaoForm" action="#" method="post">
        <div id="pontos-container">
            <!-- Pontos serão adicionados dinamicamente aqui -->
        </div>

        <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-success" id="adicionar-ponto">
                <i class="bi bi-plus-circle"></i> Adicionar Ponto
            </button>

            <div>
                <button type="submit" class="btn btn-primary">Enviar</button>
                <a href="/selecionarMetodo" class="btn btn-secondary">Voltar</a>
            </div>
        </div>
    </form>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Implementação da LinkedList
    class Node {
        constructor(data) {
            this.data = data;
            this.next = null;
        }
    }

    class LinkedList {
        constructor() {
            this.head = null;
            this.size = 0;
        }

        add(data) {
            const newNode = new Node(data);

            if (!this.head) {
                this.head = newNode;
            } else {
                let current = this.head;
                while (current.next) {
                    current = current.next;
                }
                current.next = newNode;
            }

            this.size++;
        }

        remove(index) {
            if (index < 0 || index >= this.size) {
                return null;
            }

            let current = this.head;
            let previous = null;
            let count = 0;

            if (index === 0) {
                this.head = current.next;
            } else {
                while (count < index) {
                    previous = current;
                    current = current.next;
                    count++;
                }
                previous.next = current.next;
            }

            this.size--;
            return current.data;
        }

        toArray() {
            const result = [];
            let current = this.head;

            while (current) {
                result.push(current.data);
                current = current.next;
            }

            return result;
        }
    }

    // Lista para armazenar os pontos
    const pontosLinkedList = new LinkedList();

    // Contador de pontos
    let pontoCounter = 0;

    // Função para criar um novo ponto
    function criarPonto() {
        pontoCounter++;

        const pontoDiv = document.createElement('div');
        pontoDiv.className = 'ponto-container';
        pontoDiv.id = `ponto-${pontoCounter}`;

        pontoDiv.innerHTML = `
        <div class="ponto-header">
          <h5 class="mb-0">Ponto ${pontoCounter}</h5>
          <button type="button" class="btn btn-danger btn-sm remover-ponto" data-ponto-id="${pontoCounter}">
            <i class="bi bi-trash"></i> Excluir
          </button>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="pv${pontoCounter}" class="form-label">PV:</label>
            <input type="text" class="form-control" id="pv${pontoCounter}" name="pontos[${pontoCounter-1}][pv]" required>
          </div>
          <div class="col-md-6">
            <label for="dist${pontoCounter}" class="form-label">Distância:</label>
            <input type="number" step="0.01" class="form-control" id="dist${pontoCounter}" name="pontos[${pontoCounter-1}][dist]" required>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Ângulo:</label>
            <div class="coords-container">
              <span class="coords-label">Graus:</span>
              <input type="number" class="form-control" name="pontos[${pontoCounter-1}][ang_graus]" required>
              <span class="coords-label">Minutos:</span>
              <input type="number" class="form-control" name="pontos[${pontoCounter-1}][ang_min]" required>
              <span class="coords-label">Segundos:</span>
              <input type="number" class="form-control" name="pontos[${pontoCounter-1}][ang_seg]" required>
            </div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Azimute:</label>
            <div class="coords-container">
              <span class="coords-label">Graus:</span>
              <input type="number" class="form-control" name="pontos[${pontoCounter-1}][az_graus]" required>
              <span class="coords-label">Minutos:</span>
              <input type="number" class="form-control" name="pontos[${pontoCounter-1}][az_min]" required>
              <span class="coords-label">Segundos:</span>
              <input type="number" class="form-control" name="pontos[${pontoCounter-1}][az_seg]" required>
            </div>
          </div>
        </div>
      `;

        return pontoDiv;
    }

    // Função para adicionar um ponto
    function adicionarPonto() {
        const container = document.getElementById('pontos-container');
        const novoPonto = criarPonto();
        container.appendChild(novoPonto);

        // Adicionar evento de remoção ao botão
        const removerBtn = novoPonto.querySelector('.remover-ponto');
        removerBtn.addEventListener('click', function() {
            const pontoId = this.getAttribute('data-ponto-id');
            removerPonto(pontoId);
        });
    }

    // Função para remover um ponto
    function removerPonto(pontoId) {
        const pontoElement = document.getElementById(`ponto-${pontoId}`);
        if (pontoElement) {
            pontoElement.remove();

            // Reorganizar os números dos pontos
            const pontos = document.querySelectorAll('.ponto-container');
            pontos.forEach((ponto, index) => {
                const header = ponto.querySelector('h5');
                header.textContent = `Ponto ${index + 1}`;

                // Atualizar o data-ponto-id do botão de remover
                const removerBtn = ponto.querySelector('.remover-ponto');
                removerBtn.setAttribute('data-ponto-id', index + 1);
            });

            pontoCounter = pontos.length;
        }
    }

    // Função para coletar dados do formulário e adicionar à LinkedList
    function coletarDadosFormulario() {
        // Limpar a lista atual
        while (pontosLinkedList.size > 0) {
            pontosLinkedList.remove(0);
        }

        // Coletar dados de todos os pontos
        const pontos = document.querySelectorAll('.ponto-container');

        pontos.forEach((ponto, index) => {
            const pv = ponto.querySelector(`input[name="pontos[${index}][pv]"]`).value;
            const dist = ponto.querySelector(`input[name="pontos[${index}][dist]"]`).value;
            const ang_graus = ponto.querySelector(`input[name="pontos[${index}][ang_graus]"]`).value;
            const ang_min = ponto.querySelector(`input[name="pontos[${index}][ang_min]"]`).value;
            const ang_seg = ponto.querySelector(`input[name="pontos[${index}][ang_seg]"]`).value;
            const az_graus = ponto.querySelector(`input[name="pontos[${index}][az_graus]"]`).value;
            const az_min = ponto.querySelector(`input[name="pontos[${index}][az_min]"]`).value;
            const az_seg = ponto.querySelector(`input[name="pontos[${index}][az_seg]"]`).value;

            const pontoData = {
                pv,
                dist,
                ang_graus,
                ang_min,
                ang_seg,
                az_graus,
                az_min,
                az_seg
            };

            pontosLinkedList.add(pontoData);
        });

        // Exibir no console para demonstração
        console.log("Dados da LinkedList:", pontosLinkedList.toArray());

        // Aqui você pode enviar os dados para o Spring Boot
        // Por exemplo, usando fetch API
        // enviarParaSpringBoot(pontosLinkedList.toArray());
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
        // Adicionar 3 pontos iniciais
        for (let i = 0; i < 3; i++) {
            adicionarPonto();
        }

        // Evento para adicionar ponto
        document.getElementById('adicionar-ponto').addEventListener('click', adicionarPonto);

        // Evento para enviar formulário
        document.getElementById('irradiacaoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            coletarDadosFormulario();

            // Aqui você pode adicionar a lógica para enviar os dados
            alert('Dados coletados e armazenados na LinkedList! Verifique o console.');
        });
    });
</script>
</body>
</html>